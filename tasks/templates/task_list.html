<!-- templates/task_list.html -->
{% extends 'base.html' %}

{% block content %}
<div class="flex items-center justify-between mb-8">
    
    <div class="flex justify-center top-1">
        <div class="relative">
            <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 pointer-events-none"></i>
          <input type="text" id="search" placeholder="Search tasks" class="bg-gray-100 p-1 rounded-md pl-10">
        </div>
      </div>
</div>
<div class="flex justify-between mb-8">
    <div class="flex space-x-4">
        <button id="preview" class="bg-gray-200 p-2 rounded-lg flex items-center">
            <i class="fas fa-eye mr-2"></i> Preview
        </button>
        <button id="sort" class="bg-gray-200 p-2 rounded-lg flex items-center">
            <i class="fas fa-sort mr-2"></i> Sort
        </button>
        <button id="filter" class="bg-gray-200 p-2 rounded-lg flex items-center">
            <i class="fas fa-filter mr-2"></i> Filter
        </button>
    </div>
    <div>
        <a href="{% url 'add_task' %}" class="bg-purple-700 text-white px-4 py-2 rounded-lg">+ Add Task</a>
    </div>
</div>


<div id="tasks" class="flex space-x-8">
    <!-- Tasks will be loaded here by jQuery AJAX -->
</div>
{% endblock %}

{% block scripts %}
<script>
$(document).ready(function() {
    function loadTasks(status) {
        $.ajax({
            url: "{% url 'api_tasks' %}",
            data: {status: status},
            success: function(response) {
                var tasksDiv = $('#tasks');
                tasksDiv.empty();
                var tasks = response.tasks;
                var statusCounts = response.status_counts;
                
                tasks.forEach(function(task) {
                    var dueDate = new Date(task.due_date).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', hour12: true });
                    var taskDiv = `
                        <div class="w-1/3 p-2">
                            <div class="flex justify-between items-center border rounded-md p-3 mb-4">
                                <h2 class="text-sm font-bold">${task.status} (${statusCounts[task.status]})</h2>
                                <i class="fas fa-ellipsis-v"></i>
                            </div>
                            <div class="flex justify-between mb-5 items-center">
                                <span class="bg-red-200 text-red-800 px-3 py-1 rounded">${task.priority}</span>
                                <span class="text-gray-500 rounded-md shadow-md">
                                    <i class="far fa-clock p-2"></i> ${dueDate}
                                </span>
                                <span class="bg-purple-200 text-purple-800 px-3 py-1 rounded">${task.category}</span>
                            </div>
                            <div class="bg-white p-6 rounded-lg mb-6 shadow-md">
                                <h3 class="font-semibold mt-0">${task.title}</h3>
                                <p class="text-gray-600 text-sm mt-5">${task.description}</p>
                                <div class="flex justify-between items-center mt-6">
                                    <div class="flex space-x-4">
                                        <a href="/tasks/edit/${task.id}/" class="text-gray-500">✏️</a>
                                        <a href="/tasks/delete/${task.id}/" class="text-gray-500">🗑️</a>
                                    </div>
                                </div>
                            </div>
                        </div>`;
                    tasksDiv.append(taskDiv);
                });
            }
        });
    }

    loadTasks();

    $('#search').on('input', function() {
        var search = $(this).val().toLowerCase();
        $('#tasks div').filter(function() {
            $(this).toggle($(this).text().toLowerCase().indexOf(search) > -1)
        });
    });

    $('#filter, #sort').on('click', function() {
        var status = $(this).data('status');
        loadTasks(status);
    });
});

</script>
{% endblock %}
